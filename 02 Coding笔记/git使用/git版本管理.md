---
tags:
  - Dev/Git
  - CS/VersionControl
aliases:
  - Git版本管理
  - Git打标签
  - Git Tagging
---

### 基本原则与流程

在 `main` 分支上通过创建分支和添加标签来管理版本。标准的发布流程如下：
1.  **确认代码**：确保代码中的版本信息已正确配置。
2.  **创建分支**：基于 `main` 分支创建发布分支，如 `release/v1.0.1`。
3.  **添加标签**：为此次发布的提交打上对应的版本标签，如 `v1.0.1`。
4.  **推送远程**：将新的发布分支和标签推送到远程仓库。

### 标准打标签操作

#### 1. 准备分支
切换到主分支并拉取最新代码
```
git checkout main
git pull
```
创建并切换到发布分支
```
git checkout -b release/v1.0.1
```

#### 2. 确定目标提交
查看提交历史，找到需要打标签的 commit hash
```
git log --oneline -10
```
记录目标提交的完整或前7位哈希值。

#### 3. 创建标签
格式: git tag -a <标签名> [提交哈希] -m "<标签描述>"
为当前最新提交打标签
```
git tag -a v1.0.1 -m "发布版本v1.0.1"
```

为特定提交打标签 (推荐，可避免出错)
```
git tag -a v1.0.1 <commit_hash> -m "发布版本v1.0.1"
```

#### 4. 标签命名规范
-   **版本标签**: `v1.0.1`, `v2.3.4`
-   **预发布标签**: `v1.0.1-rc1`, `v2.0.0-beta`
-   **功能标签**: `feature/user-auth`, `bugfix/login-issue`

#### 5. 验证标签 (可选)
查看所有标签
```
git tag
```

按模式筛选
```
git tag -l "v1.*"
```

查看标签详情
```
git show v1.0.1
```

#### 6. 推送标签到远程
推送指定标签
```
git push origin v1.0.1
```

推送所有本地标签
```
git push origin --tags
```

### 特殊情况处理

#### 修改历史提交并打标签 (使用变基)
适用于需要修改某个历史提交（如补充版本信息）后再打标签的场景。

> [!WARNING] 操作警告
> 变基 (rebase) 是一项危险操作，会修改提交历史，且极易引发代码冲突。请务必谨慎使用，优先选择在发布前就确认好所有信息。

###### 1. 开始交互式变基，[commit] 为目标提交的父提交哈希
```
git rebase -i [commit]
```

###### 2. 在编辑器中，将需要修改的提交行的 `pick` 改为 `edit` 并保存退出
###### 3. 修改文件内容
###### 4. 暂存并修正提交
```
git add .
git commit --amend
git rebase --continue
```

###### 5. 为修正后的提交打标签
```
git tag -a <标签名> -m "<描述>"
```

###### 6. 删除标签
删除本地标签
```
git tag -d <标签名>
```

删除远程标签
```
git push origin --delete <标签名>
```

### 常见问题解决

###### 1. 标签已存在
如果需要更新一个已存在的标签：
先删除本地和远程的旧标签
```
git tag -d <标签名>
git push origin --delete <标签名>
```

###### 2. 重新创建并推送新标签
```
git tag -a <标签名> -m "<新描述>"
git push origin <标签名>
```

###### 3. 推送被拒绝
通常发生在修改了已推送的分支历史后。
强制推送 (`谨慎使用`，确保了解其影响)
```
git push --force-with-lease origin <分支名>
```
